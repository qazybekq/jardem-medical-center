# 📊 БИЗНЕС-АНАЛИТИК + UX/UI ОТЧЕТ: CRUD для справочников

**Дата:** 2025-10-20  
**Версия:** 3.0  
**Авторы:** Senior Business Analyst + Senior UX/UI Designer  
**Статус:** ✅ Готово к разработке

---

## 🎯 ЦЕЛЬ ПРОЕКТА

Реализовать полноценное управление справочниками (врачи, клиенты, услуги, приемы) с правами доступа для owner и admin, не нарушая текущий функционал системы.

---

## 📋 БИЗНЕС-ТРЕБОВАНИЯ

### 1. Функциональные требования

#### 1.1 Управление врачами
- **Просмотр:** Список всех врачей с ключевой информацией
- **Добавление:** Форма создания нового врача
- **Редактирование:** Изменение данных существующего врача
- **Удаление:** Деактивация врача (мягкое удаление) с проверкой на наличие приемов
- **Поля:** Имя, Фамилия, Специализация, Телефон, Email, Статус (активен/неактивен)

#### 1.2 Управление клиентами
- **Просмотр:** Список всех клиентов с поиском и фильтрацией
- **Добавление:** Форма создания нового клиента
- **Редактирование:** Изменение данных существующего клиента
- **Удаление:** Деактивация клиента (мягкое удаление) с проверкой на наличие приемов
- **Поля:** Имя, Фамилия, Дата рождения, Телефон, Email, Статус

#### 1.3 Управление услугами
- **Просмотр:** Список всех услуг с фильтрацией по врачам
- **Добавление:** Форма создания новой услуги
- **Редактирование:** Изменение данных существующей услуги
- **Удаление:** Деактивация услуги (мягкое удаление) с проверкой на наличие приемов
- **Поля:** Название, Описание, Врач, Цена, Длительность, Статус

#### 1.4 Управление приемами
- **Просмотр:** Список всех приемов с фильтрацией
- **Добавление:** Создание нового приема (уже есть в CRM)
- **Редактирование:** Изменение данных приема (уже есть в CRM)
- **Удаление:** Удаление приема с подтверждением
- **Поля:** Клиент, Врач, Услуга, Дата, Время, Статус, Оплата

### 2. Права доступа

| Роль | Просмотр | Добавление | Редактирование | Удаление |
|------|----------|------------|----------------|----------|
| Owner | ✅ | ✅ | ✅ | ✅ |
| Admin | ✅ | ✅ | ✅ | ✅ |
| CRM User | ❌ | ❌ | ❌ | ❌ |

### 3. Безопасность

- **Мягкое удаление:** Не удалять физически, а деактивировать (is_active = False)
- **Проверка зависимостей:** Перед удалением проверять наличие связанных записей
- **Аудит:** Логировать все изменения (кто, когда, что изменил)
- **Подтверждение:** Двойное подтверждение для критических операций (удаление)

---

## 🎨 UX/UI ДИЗАЙН

### 1. Навигация

#### Вариант A: Новая страница "Справочники" (РЕКОМЕНДУЕТСЯ)

**Структура навигации:**
```
Sidebar:
├── 🏥 CRM Система
├── 📊 Аналитика
├── 📚 Справочники ← НОВОЕ
│   ├── Врачи
│   ├── Клиенты
│   ├── Услуги
│   └── Приемы
├── 📋 Аудит
├── 📧 Уведомления
├── 💾 Резервные копии
└── 📥 Импорт данных
```

**Преимущества:**
- ✅ Логическое разделение: операции vs справочники
- ✅ Не перегружает главное меню
- ✅ Масштабируемость (можно добавить другие справочники)
- ✅ Понятная иерархия

**Реализация:**
```python
if user_access_level in ['owner', 'admin']:
    pages = [
        "🏥 CRM Система",
        "📊 Аналитика",
        "📚 Справочники",  # ← Новая страница
        "📋 Аудит",
        # ...
    ]
```

#### Вариант B: Подменю в CRM (НЕ РЕКОМЕНДУЕТСЯ)

**Причины отказа:**
- ❌ Перегружает CRM
- ❌ Смешивает операции и настройки
- ❌ Плохая масштабируемость

---

### 2. Дизайн страницы "Справочники"

#### 2.1 Главная страница справочников

```
┌─────────────────────────────────────────────────────────┐
│ 📚 Управление справочниками                              │
├─────────────────────────────────────────────────────────┤
│                                                           │
│  ┌────────────────┐  ┌────────────────┐                 │
│  │  👨‍⚕️ Врачи      │  │  👥 Клиенты    │                 │
│  │                 │  │                 │                 │
│  │  Всего: 5       │  │  Всего: 1234    │                 │
│  │  Активных: 5    │  │  Активных: 1200 │                 │
│  │                 │  │                 │                 │
│  │  [Управление]   │  │  [Управление]   │                 │
│  └────────────────┘  └────────────────┘                 │
│                                                           │
│  ┌────────────────┐  ┌────────────────┐                 │
│  │  💼 Услуги      │  │  📅 Приемы     │                 │
│  │                 │  │                 │                 │
│  │  Всего: 8       │  │  Всего: 987     │                 │
│  │  Активных: 8    │  │  За месяц: 156  │                 │
│  │                 │  │                 │                 │
│  │  [Управление]   │  │  [Управление]   │                 │
│  └────────────────┘  └────────────────┘                 │
│                                                           │
└─────────────────────────────────────────────────────────┘
```

#### 2.2 Страница управления (например, Врачи)

```
┌─────────────────────────────────────────────────────────┐
│ 👨‍⚕️ Управление врачами                    [➕ Добавить] │
├─────────────────────────────────────────────────────────┤
│                                                           │
│ 🔍 Поиск: [_________________]  📊 Всего: 5  ✅ Активных: 5│
│                                                           │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ Имя Фамилия      │ Специализация   │ Статус  │ ⚙️    ││
│ ├──────────────────┼─────────────────┼─────────┼──────││
│ │ Айгуль Нурланова │ Терапевт        │ ✅ Актив│ ✏️ 🗑️││
│ │ Марат Ахметов    │ Кардиолог       │ ✅ Актив│ ✏️ 🗑️││
│ │ Айша Калиева     │ Невролог        │ ✅ Актив│ ✏️ 🗑️││
│ │ Жанар Тулеуова   │ Гинеколог       │ ✅ Актив│ ✏️ 🗑️││
│ │ Ерлан Сабиров    │ Педиатр         │ ✅ Актив│ ✏️ 🗑️││
│ └─────────────────────────────────────────────────────┘ │
│                                                           │
│ Страница: [1] 2 3 ... 10                                 │
│                                                           │
└─────────────────────────────────────────────────────────┘
```

#### 2.3 Форма добавления/редактирования

```
┌─────────────────────────────────────────────────────────┐
│ ➕ Добавление врача                           [✖ Закрыть]│
├─────────────────────────────────────────────────────────┤
│                                                           │
│  Имя: *                                                   │
│  [________________]                                       │
│                                                           │
│  Фамилия: *                                              │
│  [________________]                                       │
│                                                           │
│  Специализация: *                                        │
│  [▼ Выберите...  ]                                       │
│                                                           │
│  Телефон:                                                │
│  [________________]                                       │
│                                                           │
│  Email:                                                  │
│  [________________]                                       │
│                                                           │
│  ☐ Врач активен                                          │
│                                                           │
│  [💾 Сохранить]  [❌ Отмена]                             │
│                                                           │
└─────────────────────────────────────────────────────────┘
```

#### 2.4 Диалог удаления

```
┌─────────────────────────────────────────────────────────┐
│ ⚠️ Подтверждение удаления                                │
├─────────────────────────────────────────────────────────┤
│                                                           │
│  Вы действительно хотите удалить врача?                  │
│                                                           │
│  👨‍⚕️ Айгуль Нурланова (Терапевт)                         │
│                                                           │
│  ⚠️ Внимание:                                            │
│  • У этого врача 45 приемов в системе                    │
│  • Врач будет ДЕАКТИВИРОВАН (не удален)                  │
│  • История приемов сохранится                            │
│                                                           │
│  [🗑️ Да, деактивировать]  [❌ Отмена]                    │
│                                                           │
└─────────────────────────────────────────────────────────┘
```

---

### 3. Таблицы и поля

#### 3.1 Врачи (doctors) - ЭТАП 3 (ПОСЛЕДНИЙ)

| Поле | Тип | Обязательное | Описание |
|------|-----|--------------|----------|
| id | INTEGER | ✅ | Первичный ключ |
| first_name | TEXT | ✅ | Имя |
| last_name | TEXT | ✅ | Фамилия |
| specialization | TEXT | ✅ | Специализация |
| phone | TEXT | ✅ | Телефон |
| email | TEXT | ❌ | Email (необязательное) |
| is_active | BOOLEAN | ✅ | Активен (default: True) |
| created_at | TIMESTAMP | ✅ | Дата создания |
| updated_at | TIMESTAMP | ✅ | Дата обновления |

**Действия:**
- ✏️ Редактировать: Открыть форму редактирования
- 🗑️ Удалить: Деактивировать (is_active = False)
- 👁️ Просмотр: Показать все приемы врача

#### 3.2 Клиенты (clients) - ЭТАП 1 (САМЫЙ ВАЖНЫЙ)

| Поле | Тип | Обязательное | Описание |
|------|-----|--------------|----------|
| id | INTEGER | ✅ | Первичный ключ |
| first_name | TEXT | ✅ | Имя |
| last_name | TEXT | ❌ | Фамилия (необязательная) |
| birth_date | DATE | ❌ | Дата рождения (необязательная) |
| phone | TEXT | ✅ | Телефон |
| email | TEXT | ❌ | Email (необязательное) |
| is_active | BOOLEAN | ✅ | Активен (default: True) |
| created_at | TIMESTAMP | ✅ | Дата создания |
| updated_at | TIMESTAMP | ✅ | Дата обновления |

**Действия:**
- ✏️ Редактировать
- 🗑️ Удалить (деактивировать)
- 👁️ Просмотр: История приемов клиента

#### 3.3 Услуги (services) - ЭТАП 2

| Поле | Тип | Обязательное | Описание |
|------|-----|--------------|----------|
| id | INTEGER | ✅ | Первичный ключ |
| name | TEXT | ✅ | Название |
| description | TEXT | ❌ | Описание (необязательное) |
| doctor_id | INTEGER | ✅ | FK на doctors |
| price | DECIMAL | ✅ | Цена |
| duration_minutes | INTEGER | ✅ | Длительность (мин) |
| is_active | BOOLEAN | ✅ | Активен (default: True) |
| created_at | TIMESTAMP | ✅ | Дата создания |
| updated_at | TIMESTAMP | ✅ | Дата обновления |

**Действия:**
- ✏️ Редактировать
- 🗑️ Удалить (деактивировать)
- 👁️ Просмотр: Количество приемов с этой услугой

#### 3.4 Приемы (appointments)

**Примечание:** Управление приемами уже есть в CRM. Здесь нужен только **просмотр и массовое удаление**.

| Поле | Тип | Обязательное | Описание |
|------|-----|--------------|----------|
| id | INTEGER | ✅ | Первичный ключ |
| client_id | INTEGER | ✅ | FK на clients |
| doctor_id | INTEGER | ✅ | FK на doctors |
| service_id | INTEGER | ✅ | FK на services |
| appointment_date | DATE | ✅ | Дата приема |
| appointment_time | TIME | ✅ | Время приема |
| status | TEXT | ✅ | Статус приема |
| payment_status | TEXT | ✅ | Статус оплаты |
| notes | TEXT | ❌ | Примечания |
| source | TEXT | ❌ | Источник |

**Действия:**
- 👁️ Просмотр: Список всех приемов с фильтрацией
- 🗑️ Массовое удаление: Удалить несколько приемов за период
- ✏️ Редактирование: Перейти в CRM для редактирования

---

### 4. UX/UI Принципы

#### 4.1 Цветовая схема

- **Успех:** 🟢 Зеленый (#28a745)
- **Предупреждение:** 🟡 Желтый (#ffc107)
- **Опасность:** 🔴 Красный (#dc3545)
- **Информация:** 🔵 Синий (#17a2b8)
- **Нейтральный:** ⚪ Серый (#6c757d)

#### 4.2 Иконки

- ➕ Добавить
- ✏️ Редактировать
- 🗑️ Удалить
- 👁️ Просмотр
- 🔍 Поиск
- 📊 Статистика
- ✅ Активен
- ❌ Неактивен

#### 4.3 Интерактивность

- **Hover:** Подсветка строки таблицы
- **Click:** Открытие формы редактирования
- **Drag & Drop:** Сортировка столбцов (опционально)
- **Double Click:** Быстрое редактирование (опционально)

#### 4.4 Отзывчивость

- **Успешное действие:** ✅ "Врач успешно добавлен!"
- **Ошибка:** ❌ "Ошибка: не удалось сохранить врача"
- **Подтверждение:** ⚠️ "Вы уверены?"
- **Загрузка:** ⏳ "Загрузка данных..."

---

### 5. Пользовательские сценарии (User Stories)

#### UC-1: Добавление врача

**Как** администратор  
**Я хочу** добавить нового врача  
**Чтобы** он мог принимать пациентов

**Шаги:**
1. Перейти в "Справочники" → "Врачи"
2. Нажать "➕ Добавить"
3. Заполнить форму (Имя, Фамилия, Специализация, Телефон, Email)
4. Нажать "💾 Сохранить"
5. Увидеть сообщение "✅ Врач успешно добавлен!"
6. Увидеть врача в списке

**Валидация:**
- Имя и Фамилия: не пустые, мин. 2 символа
- Специализация: выбор из списка
- Телефон: формат +7 (XXX) XXX-XX-XX
- Email: валидный email

#### UC-2: Редактирование врача

**Как** администратор  
**Я хочу** изменить данные врача  
**Чтобы** информация была актуальной

**Шаги:**
1. Перейти в "Справочники" → "Врачи"
2. Найти врача в списке
3. Нажать "✏️" рядом с врачом
4. Изменить нужные поля
5. Нажать "💾 Сохранить"
6. Увидеть сообщение "✅ Данные обновлены!"

**Валидация:** Аналогично UC-1

#### UC-3: Деактивация врача

**Как** администратор  
**Я хочу** деактивировать врача  
**Чтобы** он больше не появлялся в списке активных

**Шаги:**
1. Перейти в "Справочники" → "Врачи"
2. Найти врача в списке
3. Нажать "🗑️" рядом с врачом
4. Увидеть диалог подтверждения с предупреждением
5. Подтвердить деактивацию
6. Увидеть сообщение "✅ Врач деактивирован"
7. Врач исчезает из списка активных (но остается в БД)

**Проверки:**
- Если у врача есть будущие приемы → предупредить
- Если у врача нет приемов → можно деактивировать без предупреждения

#### UC-4: Поиск клиента

**Как** администратор  
**Я хочу** быстро найти клиента  
**Чтобы** просмотреть или изменить его данные

**Шаги:**
1. Перейти в "Справочники" → "Клиенты"
2. Ввести в поле поиска: "Иванов"
3. Увидеть отфильтрованный список клиентов
4. Выбрать нужного клиента
5. Нажать "✏️" для редактирования

**Поиск работает по:**
- Имени
- Фамилии
- Телефону
- Email

---

### 6. Бизнес-метрики

#### 6.1 Операционные метрики

- **Время создания записи:** < 30 секунд
- **Время поиска:** < 2 секунд
- **Количество кликов для добавления:** ≤ 3
- **Количество ошибок при вводе:** < 5%

#### 6.2 Метрики использования

- **Частота добавления врачей:** ~1-2 в месяц
- **Частота редактирования клиентов:** ~10-15 в день
- **Частота обновления услуг:** ~5-10 в месяц
- **Частота удаления приемов:** ~2-5 в неделю

---

### 7. Технические требования

#### 7.1 Производительность

- **Загрузка страницы:** < 2 секунд
- **Обработка действия:** < 1 секунды
- **Поиск:** < 500 мс
- **Пагинация:** 50 записей на страницу

#### 7.2 Совместимость

- **Браузеры:** Chrome, Firefox, Safari, Edge (последние 2 версии)
- **Разрешения:** 1920x1080, 1366x768, планшеты
- **Мобильные:** Адаптивный дизайн (опционально)

#### 7.3 Безопасность

- **SQL Injection:** Защита через параметризованные запросы
- **XSS:** Экранирование HTML
- **CSRF:** Токены безопасности
- **Аудит:** Логирование всех действий

---

## 🎯 РЕКОМЕНДАЦИИ К РАЗРАБОТКЕ

### 1. Этапность внедрения (по приоритетам пользователя)

#### Этап 1: Пациенты (v3.0.0) - САМЫЙ ВАЖНЫЙ
- ✅ Создать страницу "Справочники"
- ✅ Реализовать управление пациентами (CRUD)
- ✅ Добавить права доступа (owner + admin)
- ✅ Протестировать на текущем функционале

#### Этап 2: Услуги (v3.1.0)
- ✅ Реализовать управление услугами (CRUD)
- ✅ Добавить поиск и фильтрацию для пациентов и услуг
- ✅ Добавить статистику по справочникам

#### Этап 3: Врачи (v3.2.0)
- ✅ Реализовать управление врачами (CRUD)
- ✅ Полное тестирование всех справочников
- ✅ Финальная оптимизация

### 2. Риски и митигация

| Риск | Вероятность | Воздействие | Митигация |
|------|-------------|-------------|-----------|
| Поломка текущего функционала | Средняя | Высокое | Полное тестирование после каждого этапа |
| Удаление критических данных | Низкая | Критическое | Мягкое удаление, аудит, подтверждения |
| Медленная загрузка таблиц | Средняя | Среднее | Пагинация, индексы БД, кеширование |
| Конфликты прав доступа | Низкая | Среднее | Четкая проверка прав на каждом действии |

### 3. Чек-лист для разработчика

- [ ] Создать новый модуль `directories.py`
- [ ] Добавить роут "Справочники" в навигацию
- [ ] Реализовать CRUD для врачей
- [ ] Добавить валидацию данных
- [ ] Реализовать мягкое удаление
- [ ] Добавить аудит действий
- [ ] Протестировать права доступа
- [ ] Протестировать текущий функционал (регрессия)
- [ ] Реализовать CRUD для клиентов
- [ ] Реализовать CRUD для услуг
- [ ] Реализовать просмотр приемов
- [ ] Добавить поиск и фильтрацию
- [ ] Добавить пагинацию
- [ ] Финальное тестирование

---

## 📊 WIREFRAMES (ASCII)

### Главная страница справочников

```
┌──────────────────────────────────────────────────────────────────┐
│ 🏥 Медицинский Центр                        Привет, Администратор │
├──────────────────────────────────────────────────────────────────┤
│                                                                    │
│ Sidebar:                  Main Content:                           │
│ ┌────────────┐           ┌──────────────────────────────────────┐│
│ │🏥 CRM      │           │ 📚 Управление справочниками           ││
│ │📊 Аналитика│           │                                       ││
│ │📚 Справоч. │ ← active  │ ┌───────────┐ ┌───────────┐          ││
│ │📋 Аудит    │           │ │👨‍⚕️ Врачи   │ │👥 Клиенты │          ││
│ │📧 Уведомл. │           │ │Всего: 5    │ │Всего: 1234│          ││
│ │💾 Резерв   │           │ │Актив: 5    │ │Актив: 1200│          ││
│ │📥 Импорт   │           │ │[Управление]│ │[Управление]│          ││
│ └────────────┘           │ └───────────┘ └───────────┘          ││
│                          │                                       ││
│                          │ ┌───────────┐ ┌───────────┐          ││
│                          │ │💼 Услуги   │ │📅 Приемы  │          ││
│                          │ │Всего: 8    │ │Всего: 987 │          ││
│                          │ │Актив: 8    │ │За мес: 156│          ││
│                          │ │[Управление]│ │[Управление]│          ││
│                          │ └───────────┘ └───────────┘          ││
│                          └──────────────────────────────────────┘│
│                                                                    │
└──────────────────────────────────────────────────────────────────┘
```

---

## ✅ ГОТОВО К РАЗРАБОТКЕ

Этот отчет содержит:
- ✅ Бизнес-требования
- ✅ UX/UI дизайн
- ✅ Структуру навигации
- ✅ Макеты интерфейсов
- ✅ Пользовательские сценарии
- ✅ Технические требования
- ✅ План поэтапного внедрения
- ✅ Управление рисками

**Передаю эстафету разработчику!** 🚀

---

**Авторы:**  
👔 Senior Business Analyst  
🎨 Senior UX/UI Designer  

**Дата:** 2025-10-20  
**Версия:** 3.0

